<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport" />    <title>Angus Tan</title>

    <link rel="icon" href="assets/images/AutumnLeaf.gif">
    <link href="./css/base.css" type="text/css" rel="stylesheet">
    <link href="./css/index.css" type="text/css" rel="stylesheet">
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.6.9/build/spline-viewer.js"></script>
</head>


<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VPFYQJ4C7S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VPFYQJ4C7S');
</script>

<body>

    <!-- Loader -->
    <!-- <div id="loader" class="loader">
        <div class="loader-text">ANGUS</div>
    </div> -->
    
    <!-- <scroll-top-button class="scroll-top-button"></scroll-top-button> -->
    <header-custom title = "ANGUS"></header-custom>
    
    <div class="hero-filler"></div>
    
    <div class="sticky-toc">
        <div class="sticky-toc-container">
            <div class="intro">
                <h5>ANGUS TAN</h5>
                <h2 id="toc-intro" class="toc-title">INTRO,</h2>
            </div>
            <h2 id="toc-services" class="toc-title">SERVICES,</h2>
            <h2 id="toc-works" class="toc-title">WORKS,</h2>
            <h2 id="toc-about" class="toc-title">ABOUT.</h2>
        </div>
    </div>
    
    <div class="section1 intro pad" id="intro">
        <div class="hero-container">
            <div class="hero-flex1">
                <div class="hero-flex1-container">
                    <h5>I help businesses build interactive and user-centric design that engage audiences and drive growth.</h5>
                    <cta-button-custom title="REACH OUT"></cta-button-custom>
                </div>
                
                <img src="./assets/images/Angus.JPG" />
            </div>

        </div>

    </div>

    <div class="section2 services pad" id="services">
        <!-- <h1>SERVICES,</h1> -->
         <div class="section2-header">
            <h5>
                Wanted to build a websites? I craft premium web experiences that are tailored to your brand focused on growing your business.
            </h5>
         </div>
    </div>
    
    <div class="section3 works pad" id="works">
        <!-- <h1>WORKS,</h1> -->
        
    </div>
    
    <div class="section4 about pad" id="about">
        <!-- <h1>ABOUT,</h1> -->

    </div>



    <footer-custom></footer-custom>

</body>

<script type="module">
    
import './components/header/index.js'
import './components/button/PlopButton/index.js'
import './components/card/HeroCard/index.js'
import './components/footer/index.js'
import globalContext from './datas/globalContext.js'
import {works} from './datas/home.js'
import {elementIsInViewPort, debounce} from './js/IntersectionObserver/vi.js'
import "/components/button/ScrollTopButton/index.js"
import "/components/button/CTAButton/index.js"

const filler = document.querySelector(".hero-filler");
const heroContainer = document.querySelector(".section1")
const section2 = document.querySelector(".section2");
const section2CardSection = document.querySelector(".section2-card-section");
const footer = document.querySelector("footer-custom");
const stickyToc = document.querySelector(".sticky-toc");
let section2CardElements;



setHeaderHeight()
// loadSection2Work()

/**
 * ! GSAP animation STARTS here
*/


gsap.registerPlugin(ScrollTrigger);

const sequence = ['intro', 'services', 'works', 'about'];
let titleArr = [];

const sections = document.querySelectorAll("div[id]");
const tocHeaders = {
    intro: document.getElementById("toc-intro"),
    services: document.getElementById("toc-services"),
    works: document.getElementById("toc-works"),
    about: document.getElementById("toc-about")
};


const showElement = (element) => {
    gsap.fromTo(
        element,
        { opacity: 0, height: 0, y: 0 },
        {
            opacity: 1,
            height: element.scrollHeight,
            y: 0,
            duration: 0.6,
            ease: "power1.inOut"
        }
    );
};

const hideElement = (element) => {
    gsap.to(element, {
        opacity: 0,
        height: 0,
        duration: 0.6,
        ease: "power1.inOut",
    });
};

const hideStickyToc = () => {
    gsap.fromTo(
        stickyToc,
        {
            opacity: 1,
            y: 0        
        },
        {
            opacity: 0,
            y: 500,
            duration: 0.6,
            ease: "power1.inOut"
        }
    )
}

const showStickyToc = () => {
    gsap.to(
        stickyToc,{
            opacity: 1,
            y: 0,
        }
    )
}

const highlightText = (element) => {
    gsap.fromTo(
        element,
        {
            color: "#333333",
        },
        {
            color: "#7D715C",
        }
    )
}

const disableHighlightText = (element) => {
    gsap.to(
        element,
        {
            color: "#333333",
        }
    )
}

// Register ScrollTrigger for the footer
ScrollTrigger.create({
    trigger: footer,
    start: "top 75%",
    onEnter:() => hideStickyToc(),
    onLeaveBack: () => showStickyToc()

})

// Register ScrollTrigger for each section
sections.forEach((section, index) => {
    const id = section.id;
    const tocHeader = tocHeaders[id];

    ScrollTrigger.create({
        trigger: section,
        start: "top 50%",  // Trigger when top of section hits 80% of viewport
        end: "bottom 50%", // End when bottom of section hits 20% of viewport
        onEnter: () => {
            handleEnter(id, tocHeader)
            highlightText(tocHeader)
        },
        onLeaveBack: () => {
            handleLeaveBack(id, tocHeader)
        },
        onLeave: () => {
            disableHighlightText(tocHeader)
        },
        onEnterBack: () => {
            highlightText(tocHeader)
        },
        scrub: true, // Animates based on scroll position
    });

    // Another handler
    
});

// Handle section enter logic
function handleEnter(id, tocHeader) {
    if (!titleArr.includes(id)) {
        const position = sequence.indexOf(id);

        if (titleArr.length === 0 && id !== sequence[0]) {
            // Add all elements up to the current one in sequence
            for (let i = 0; i <= position; i++) {
                titleArr.push(sequence[i]);
                showElement(tocHeaders[sequence[i]]);
            }
        } else {
            titleArr.push(id);
            showElement(tocHeader);
        }
    }
}

// Handle section leave back logic
function handleLeaveBack(id, tocHeader) {
    console.log(id)
    if (id === titleArr[titleArr.length - 1]) {
        titleArr.pop();
        hideElement(tocHeader);
    }
    else if(titleArr.length == sequence.length){
        console.log("END")
    }
}


/**
 * ! GSAP animation ENDS here
*/


// Add click event listeners to each TOC header for smooth scrolling
Object.values(tocHeaders).forEach((header) => {
    header.addEventListener('click', (event) => {
        const sectionId = event.target.id.replace('toc-', ''); // Extract section id
        
        if (sectionId === 'intro') {
            // Scroll to the very top of the page when 'INTRO' is clicked
            window.scrollTo({
                top: 0,
                behavior: 'smooth' // Smooth scrolling
            });
        } else {
            const section = document.getElementById(sectionId);

            if (section) {
                section.scrollIntoView({
                    behavior: 'smooth', // Smooth scrolling
                    block: 'start' // Align to the top of the viewport
                });
            }
        }
    });
});




// window.onload = function() {
//             const loader = document.getElementById('loader');
//             const minLoadTime = 2000;  // Minimum loading time (2 seconds)
//             const startTime = performance.now();  // Capture the start time

//             const endLoading = () => {
//                 const elapsedTime = performance.now() - startTime;
//                 const remainingTime = minLoadTime - elapsedTime;

//                 if (remainingTime > 0) {
//                     setTimeout(() => {
//                         loader.style.display = 'none';
//                     }, remainingTime);
//                 } else {
//                     loader.style.display = 'none';
//                 }
//             };

//             endLoading();
//         };

window.addEventListener('scroll', debounce(checkFooterInView, 100))

function setHeaderHeight(height){
    if(window.innerWidth > 319 && window.innerWidth < 768){
        filler.style.height = '70px'
    }else{
        filler.style.height = '250px'
    }
}

function setHeroContainerHeight(height){
    if(window.innerWidth > 319 && window.innerWidth < 768){
        const calcHeight = `calc(100vh - 70px)`
        heroContainer.style.height = calcHeight;
    }else{
        const calcHeight = `calc(100vh - 250px)`
        heroContainer.style.height = calcHeight;
    }
}

globalContext.headerHeight.subscribe(()=>{
    const height = globalContext.headerHeight.getState().height;
    setHeaderHeight(height)

    // setHeroContainerHeight(height)
})



function checkFooterInView(){
    if(elementIsInViewPort(footer, 20)){
        footer.shadowRoot.querySelector('.footer').classList.add("outer-container-show")
    }
}


</script>


</html>